<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Online Art Store</title>
    <style>
        table {
            border-collapse: collapse;
        }

        table, td, th {
            border: 1px solid black;
        }

        td, th {
            margin: 8px;
        }
    </style>
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="categoryId" id="categoryId" th:content="${categoryId}"/>
</head>
<body>
<h1>Update category:</h1>
<div>
    <div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </div>
    <div>
        <label for="categoryName">Category name</label>
        <input type="text" id="categoryName" name="categoryName" required th:value="${category.name}" />
    </div>
    <div>
        <input type="submit" id="categorySave"/>
    </div>
</div>
<div>
    <a th:href="@{/adminPage}">Back to admin page</a>
</div>
<script>
    const saveCategoryButton = document.getElementById('categorySave');
    const categoryIdMeta = document.getElementById("categoryId");
    const categoryId = categoryIdMeta.content;
    const baseURI = `http://localhost:8080/adminPage/api/v1`;

    async function categorySave() {
        const categoryNameInput = document.getElementById('categoryName');
        const category = {
            name: categoryNameInput.value
        };
        const csrfToken = document.getElementById('_csrf').content;
        console.log("Token = " + csrfToken);
        const csrfHeader = document.getElementById('_csrf_header').content;
        const response = await fetch(`${baseURI}/categories/${categoryId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                [csrfHeader]: csrfToken
            },
            body: JSON.stringify(category)
        });
        console.log("Category!!!!!" + response.status);
        if (response.status === 201) {
            const loc = response.headers.get('location');
            const resp = await fetch(`http://localhost:8080${loc}`)
            addCategory(await resp.json())
        } else {
            alert('Error: ' + response.status);
        }
    }
    saveCategoryButton.addEventListener('click', categorySave);
</script>
</body>
</html>